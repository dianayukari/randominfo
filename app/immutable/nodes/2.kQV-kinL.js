import"../chunks/DsnmJJEf.js";import{i as Ze}from"../chunks/CPQpNnFn.js";import{o as Qe,e as pe,s as Q}from"../chunks/FhcG3dpi.js";import{c as Te,h as ee,R as ea,e as ze,a as aa,b as ta,F as e,S as ra,r as ia,H as sa,s as $e,d as Ce,k as _e,T as na,V as la,f as De,i as oa,W as ke,X as Ee,g as va,Y as Ke,Z as We,_ as Ve,$ as W,a0 as Le,a1 as Ge,j as je,p as da,a2 as Ie,a3 as ua,a4 as Be,a5 as ca,a6 as fa,a7 as pa,a8 as _a,a9 as ha,aa as ma,ab as ga,ac as wa,ad as ba,ae as ya,af as ka,ag as Ea,K as xa,ah as he,ai as Aa,v as V,u as $,M as Sa,aj as E,O as f,B as D,P as c,q as Ne,Q as x,w as B,ak as Oa,al as Ta,am as Ca,an as ye,n as Ia,ao as Na}from"../chunks/BGMrN2PN.js";import{i as me}from"../chunks/CMUbuGCI.js";import{s as He,a as Ra}from"../chunks/DWTkkB4o.js";import{b as qe}from"../chunks/BRvj5Lgp.js";function oe(t,n){return n}function Da(t,n,a){for(var s=t.items,o=[],i=n.length,l=0;l<i;l++)_a(n[l].e,o,!0);var p=i>0&&o.length===0&&a!==null;if(p){var b=a.parentNode;ha(b),b.append(a),s.clear(),J(t,n[0].prev,n[i-1].next)}ma(o,()=>{for(var m=0;m<i;m++){var A=n[m];p||(s.delete(A.k),J(t,A.prev,A.next)),Be(A.e,!p)}})}function ve(t,n,a,s,o,i=null){var l=t,p={flags:n,items:new Map,first:null},b=(n&Ke)!==0;if(b){var m=t;l=ee?Te(ea(m)):m.appendChild(ze())}ee&&aa();var A=null,R=!1,S=new Map,j=ra(()=>{var O=a();return Ve(O)?O:O==null?[]:We(O)}),u,y;function k(){Ma(y,u,p,S,l,o,n,s,a),i!==null&&(u.length===0?A?je(A):A=De(()=>i(l)):A!==null&&da(A,()=>{A=null}))}ta(()=>{y??=ga,u=e(j);var O=u.length;if(R&&O===0)return;R=O===0;let L=!1;if(ee){var z=ia(l)===sa;z!==(O===0)&&(l=$e(),Te(l),Ce(!1),L=!0)}if(ee){for(var K=null,T,d=0;d<O;d++){if(_e.nodeType===na&&_e.data===la){l=_e,L=!0,Ce(!1);break}var h=u[d],M=s(h,d);T=Me(_e,p,K,null,h,M,d,o,n,a),p.items.set(M,T),K=T}O>0&&Te($e())}if(ee)O===0&&i&&(A=De(()=>i(l)));else if(oa()){var re=new Set,de=va;for(d=0;d<O;d+=1){h=u[d],M=s(h,d);var r=p.items.get(M)??S.get(M);r?(n&(ke|Ee))!==0&&Ye(r,h,d,n):(T=Me(null,p,null,null,h,M,d,o,n,a,!0),S.set(M,T)),re.add(M)}for(const[v,g]of p.items)re.has(v)||de.skipped_effects.add(g.e);de.add_callback(k)}else k();L&&Ce(!0),e(j)}),ee&&(l=_e)}function Ma(t,n,a,s,o,i,l,p,b){var m=(l&fa)!==0,A=(l&(ke|Ee))!==0,R=n.length,S=a.items,j=a.first,u=j,y,k=null,O,L=[],z=[],K,T,d,h;if(m)for(h=0;h<R;h+=1)K=n[h],T=p(K,h),d=S.get(T),d!==void 0&&(d.a?.measure(),(O??=new Set).add(d));for(h=0;h<R;h+=1){if(K=n[h],T=p(K,h),d=S.get(T),d===void 0){var M=s.get(T);if(M!==void 0){s.delete(T),S.set(T,M);var re=k?k.next:u;J(a,k,M),J(a,M,re),Re(M,re,o),k=M}else{var de=u?u.e.nodes_start:o;k=Me(de,a,k,k===null?a.first:k.next,K,T,h,i,l,b)}S.set(T,k),L=[],z=[],u=k.next;continue}if(A&&Ye(d,K,h,l),(d.e.f&Ie)!==0&&(je(d.e),m&&(d.a?.unfix(),(O??=new Set).delete(d))),d!==u){if(y!==void 0&&y.has(d)){if(L.length<z.length){var r=z[0],v;k=r.prev;var g=L[0],C=L[L.length-1];for(v=0;v<L.length;v+=1)Re(L[v],r,o);for(v=0;v<z.length;v+=1)y.delete(z[v]);J(a,g.prev,C.next),J(a,k,g),J(a,C,r),u=r,k=C,h-=1,L=[],z=[]}else y.delete(d),Re(d,u,o),J(a,d.prev,d.next),J(a,d,k===null?a.first:k.next),J(a,k,d),k=d;continue}for(L=[],z=[];u!==null&&u.k!==T;)(u.e.f&Ie)===0&&(y??=new Set).add(u),z.push(u),u=u.next;if(u===null)continue;d=u}L.push(d),k=d,u=d.next}if(u!==null||y!==void 0){for(var G=y===void 0?[]:We(y);u!==null;)(u.e.f&Ie)===0&&G.push(u),u=u.next;var H=G.length;if(H>0){var ie=(l&Ke)!==0&&R===0?o:null;if(m){for(h=0;h<H;h+=1)G[h].a?.measure();for(h=0;h<H;h+=1)G[h].a?.fix()}Da(a,G,ie)}}m&&ua(()=>{if(O!==void 0)for(d of O)d.a?.apply()}),t.first=a.first&&a.first.e,t.last=k&&k.e;for(var U of s.values())Be(U.e);s.clear()}function Ye(t,n,a,s){(s&ke)!==0&&Ge(t.v,n),(s&Ee)!==0?Ge(t.i,a):t.i=a}function Me(t,n,a,s,o,i,l,p,b,m,A){var R=(b&ke)!==0,S=(b&ca)===0,j=R?S?W(o,!1,!1):Le(o):o,u=(b&Ee)===0?l:Le(l),y={i:u,v:j,k:i,a:null,e:null,prev:a,next:s};try{if(t===null){var k=document.createDocumentFragment();k.append(t=ze())}return y.e=De(()=>p(t,j,u,m),ee),y.e.prev=a&&a.e,y.e.next=s&&s.e,a===null?A||(n.first=y):(a.next=y,a.e.next=y.e),s!==null&&(s.prev=y,s.e.prev=y.e),y}finally{}}function Re(t,n,a){for(var s=t.next?t.next.e.nodes_start:a,o=n?n.e.nodes_start:a,i=t.e.nodes_start;i!==null&&i!==s;){var l=pa(i);o.before(i),i=l}}function J(t,n,a){n===null?t.first=a:(n.next=a,n.e.next=a&&a.e),a!==null&&(a.prev=n,a.e.prev=n&&n.e)}const Fe=[...` 	
\r\fÂ \v\uFEFF`];function Pa(t,n,a){var s=""+t;if(a){for(var o in a)if(a[o])s=s?s+" "+o:o;else if(s.length)for(var i=o.length,l=0;(l=s.indexOf(o,l))>=0;){var p=l+i;(l===0||Fe.includes(s[l-1]))&&(p===s.length||Fe.includes(s[p]))?s=(l===0?"":s.substring(0,l))+s.substring(p+1):l=p}}return s===""?null:s}function $a(t,n,a,s,o,i){var l=t.__className;if(ee||l!==a||l===void 0){var p=Pa(a,s,i);(!ee||p!==t.getAttribute("class"))&&(p==null?t.removeAttribute("class"):t.className=p),t.__className=a}else if(i&&o!==i)for(var b in i){var m=!!i[b];(o==null||m!==!!o[b])&&t.classList.toggle(b,m)}return i}function Je(t,n,a=!1){if(t.multiple){if(n==null)return;if(!Ve(n))return ya();for(var s of t.options)s.selected=n.includes(ge(s));return}for(s of t.options){var o=ge(s);if(ka(o,n)){s.selected=!0;return}}(!a||n!==void 0)&&(t.selectedIndex=-1)}function La(t){var n=new MutationObserver(()=>{Je(t,t.__value)});n.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ea(()=>{n.disconnect()})}function Ga(t,n,a=n){var s=!0;wa(t,"change",o=>{var i=o?"[selected]":":checked",l;if(t.multiple)l=[].map.call(t.querySelectorAll(i),ge);else{var p=t.querySelector(i)??t.querySelector("option:not([disabled])");l=p&&ge(p)}a(l)}),ba(()=>{var o=n();if(Je(t,o,s),s&&o===void 0){var i=t.querySelector(":checked");i!==null&&(o=ge(i),a(o))}t.__value=o,s=!1}),La(t)}function ge(t){return"__value"in t?t.__value:t.value}var Ha=V('<div class="participant-item svelte-1uha8ag"><div class="position svelte-1uha8ag"> </div> <div class="participant-name"> </div></div>'),qa=V('<div class="theme-group"><h3 class="theme-title svelte-1uha8ag"> </h3> <div class="theme-participants"></div></div>'),Fa=V('<div class="participant-item svelte-1uha8ag"><div class="position svelte-1uha8ag"></div> <div class="participant-info"><div class="participant-name"> </div></div></div>'),za=V('<div class="participant-item svelte-1uha8ag"><div class="position svelte-1uha8ag"></div> <div class="participant-info"><div class="participant-name"> </div></div></div>'),Ka=V('<div class="participant-item svelte-1uha8ag"><div class="position svelte-1uha8ag"></div> <div class="participant-info"><div class="participant-name"> </div></div></div>'),Wa=V('<div class="participant-item svelte-1uha8ag"><div class="position svelte-1uha8ag"></div> <div class="participant-info"><div class="participant-name"> </div></div></div>'),Va=V("<p>No order generated yet.</p>"),ja=V(`<div class="rabbit svelte-1uha8ag"><img alt="Rabbit illustration" width="120"/></div> <div class="results svelte-1uha8ag"><div class="grouped-view svelte-1uha8ag"><h2 class="title-order svelte-1uha8ag">Grouped order</h2> <!></div> <div class="simple-view svelte-1uha8ag"><h2 class="title-order simple svelte-1uha8ag">Simple order</h2> <div class="participant-list-simple svelte-1uha8ag"><div class="participant-list-item"></div> <div class="participant-list-item"></div> <div class="participant-list-item"></div> <div class="participant-list-item"></div></div></div> <!></div> <div class="clear-section svelte-1uha8ag"><p class="clear-sign svelte-1uha8ag">don't press it unless the term is over</p> <button class="clear-button svelte-1uha8ag"><span>DANGER!! <br/> Clear all data</span></button></div>`,1),Ba=V("<option> </option>"),Ya=V("<p>Generating...</p>"),Ja=V(`<div class="input-section svelte-1uha8ag"><div class="participant-list svelte-1uha8ag"><div class="select-container svelte-1uha8ag"><p class="svelte-1uha8ag">Who are you?</p> <select class="name-input svelte-1uha8ag"></select></div> <div class="rabbit1"><img alt="Rabbit illustration" width="120"/></div></div> <div class="keywords-container svelte-1uha8ag"><p class="svelte-1uha8ag">What are you up to?</p> <textarea class="keywords-input svelte-1uha8ag" placeholder="Keywords (comma separated)" rows="6"></textarea></div></div> <div class="action-section"><button class="save-button svelte-1uha8ag"><!></button> <button><!></button></div> <div class="clear-section svelte-1uha8ag"><p class="clear-sign svelte-1uha8ag">don't press it unless the term is over</p> <button class="clear-button svelte-1uha8ag"><span>DANGER!! <br/> Clear all data</span></button></div>`,1),Ua=V('<div class="main svelte-1uha8ag"><!></div>');function it(t,n){xa(n,!1);const a=W(),s=W(),o=W();let i=W([{name:"Arnar",id:0,keywords:""},{name:"Cassandra",id:1,keywords:""},{name:"Costanza",id:2,keywords:""},{name:"Diana",id:3,keywords:""},{name:"Haotong",id:4,keywords:""},{name:"Kosara",id:5,keywords:""},{name:"Li",id:6,keywords:""},{name:"Luca M",id:7,keywords:""},{name:"Luca W",id:8,keywords:""},{name:"Lucas G",id:9,keywords:""},{name:"Martina",id:10,keywords:""},{name:"Matteo",id:11,keywords:""},{name:"Samuel",id:12,keywords:""},{name:"Sergio",id:13,keywords:""},{name:"Zhiyi",id:14,keywords:""}]),l=W(!1),p=W(!1),b=W([]),m=W([]),A=[],R=W(!1),S=W(0),j=!1,u=W(!1);const y="https://randominfo.vercel.app";Qe(async()=>{console.log("App mounting - initial state:",{participantCount:e(i).length,isRandomized:e(R),presentationOrderLength:e(b).length}),await k(),console.log("After loadData - final state:",{participantCount:e(i).length,isRandomized:e(R),presentationOrderLength:e(b).length})});async function k(){try{const r=await fetch(`${y}/api/data`);if(r.ok){const v=await r.json();E(i,v.participants||e(i)),E(S,v.selectedParticipantId??0),E(R,v.isRandomized||!1),E(b,v.presentationOrder||[]),E(m,v.simpleOrder||[]),A=v.groups||[],console.log("Data loaded successfully from server")}else console.warn("Server responded with error:",r.status,r.statusText),console.log("Keeping existing data intact")}catch(r){console.error("Error loading data:",r),console.log("Network/fetch error - keeping existing data intact")}}async function O(){if(!j){j=!0;try{const r=await fetch(`${y}/api/data`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({participants:e(i),selectedParticipantId:e(S),isRandomized:e(R),presentationOrder:e(b),simpleOrder:e(m),groups:A})});r.ok?(console.log("Data saved successfully to server"),E(u,!0)):(console.error("Failed to save data - server responded with:",r.status,r.statusText),E(u,!1))}catch(r){console.error("Error saving data:",r),console.error("Network/server error during save"),E(u,!1)}finally{j=!1}}}function L(r){E(u,!1);const v=e(i).map(g=>g.id===e(a).id?{...g,keywords:r.target.value}:g);E(i,v)}async function z(){try{(await fetch(`${y}/api/data`,{method:"DELETE"})).ok?(E(i,e(i).map(v=>({...v,keywords:""}))),E(R,!1),E(b,[]),E(m,[]),A=[],E(S,0)):console.error("Failed to clear data")}catch(r){console.error("Error clearing data:",r)}}function K(r){const v=[...r];for(let g=v.length-1;g>0;g--){const C=Math.floor(Math.random()*(g+1));[v[g],v[C]]=[v[C],v[g]]}return v}function T(){return e(i).filter(r=>r.keywords.trim()!=="").map(r=>({name:r.name,keywords:r.keywords.trim()}))}async function d(){if(!(!e(p)||e(R))){E(l,!0);try{console.log(`Calling API at ${y}`);const r=T(),v=await fetch(`${y}/api/group-topics`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({participants:r})});if(!v.ok){const H=await v.json().catch(()=>({}));throw new Error(H.message||`HTTP ${v.status}: ${v.statusText}`)}const g=await v.json();if(!g.groups||!Array.isArray(g.groups))throw new Error("Invalid response format from server");console.log("Received data:",g);const C=K([...g.groups]),G=[];C.forEach(H=>{K([...H.members]).forEach(U=>{G.push({...U,theme:H.theme})})}),E(b,G),A=C,E(m,K([...T()])),E(R,!0),await O()}catch(r){console.error("Error generating order:",r),`${r.message}`,r.message.includes("fetch")||r.message.includes("quota")||r.message.includes("API key")}finally{E(l,!1)}}}he(()=>e(i),()=>{E(p,e(i).every(r=>r.keywords.trim()!==""))}),he(()=>(e(i),e(S)),()=>{E(a,e(i).find(r=>r.id===e(S))||e(i)[0])}),he(()=>e(S),()=>{e(S)!==void 0&&E(u,!1)}),he(()=>e(i),()=>{E(s,e(i).filter(r=>r.keywords.trim()!=="").length)}),he(()=>e(b),()=>{E(o,e(b).reduce((r,v,g)=>{const C=v.theme;return r[C]||(r[C]=[]),r[C].push({...v,position:g+1}),r},{}))}),Aa(),Ze();var h=Ua(),M=f(h);{var re=r=>{var v=ja(),g=Ne(v),C=f(g);c(g);var G=x(g,2),H=f(G),ie=x(f(H),2);ve(ie,1,()=>(e(o),D(()=>Object.entries(e(o)))),oe,(F,P,Y,I)=>{var q=Ca(()=>Na(e(P),2));let _=()=>e(q)[0],w=()=>e(q)[1];var N=qa(),le=f(N),ue=f(le,!0);c(le);var X=x(le,2);ve(X,5,w,oe,(ce,Z)=>{var Se=Ha(),Oe=f(Se),Ue=f(Oe);c(Oe);var Pe=x(Oe,2),Xe=f(Pe,!0);c(Pe),c(Se),B(()=>{Q(Ue,`${e(Z),D(()=>e(Z).position)??""}.`),Q(Xe,(e(Z),D(()=>e(Z).name)))}),$(ce,Se)}),c(X),c(N),B(()=>Q(ue,_())),$(F,N)}),c(H);var U=x(H,2),fe=x(f(U),2),se=f(fe);ve(se,5,()=>(e(m),D(()=>e(m).slice(0,4))),oe,(F,P,Y)=>{var I=Fa(),q=f(I);q.textContent=`${Y+1}.`;var _=x(q,2),w=f(_),N=f(w,!0);c(w),c(_),c(I),B(()=>Q(N,(e(P),D(()=>[e(P).name])))),$(F,I)}),c(se);var ne=x(se,2);ve(ne,5,()=>(e(m),D(()=>e(m).slice(4,8))),oe,(F,P,Y)=>{var I=za(),q=f(I);q.textContent=`${Y+5}.`;var _=x(q,2),w=f(_),N=f(w,!0);c(w),c(_),c(I),B(()=>Q(N,(e(P),D(()=>[e(P).name])))),$(F,I)}),c(ne);var ae=x(ne,2);ve(ae,5,()=>(e(m),D(()=>e(m).slice(8,12))),oe,(F,P,Y)=>{var I=Ka(),q=f(I);q.textContent=`${Y+9}.`;var _=x(q,2),w=f(_),N=f(w,!0);c(w),c(_),c(I),B(()=>Q(N,(e(P),D(()=>[e(P).name])))),$(F,I)}),c(ae);var we=x(ae,2);ve(we,5,()=>(e(m),D(()=>e(m).slice(12,16))),oe,(F,P,Y)=>{var I=Wa(),q=f(I);q.textContent=`${Y+13}.`;var _=x(q,2),w=f(_),N=f(w,!0);c(w),c(_),c(I),B(()=>Q(N,(e(P),D(()=>[e(P).name])))),$(F,I)}),c(we),c(fe),c(U);var xe=x(U,2);{var Ae=F=>{var P=Va();$(F,P)};me(xe,F=>{e(b),D(()=>e(b).length===0)&&F(Ae)})}c(G);var te=x(G,2),be=x(f(te),2);c(te),B(()=>He(C,"src",`${qe??""}/rabbit2.png`)),pe("click",be,z),$(r,v)},de=r=>{var v=Ja(),g=Ne(v),C=f(g),G=f(C),H=x(f(G),2);B(()=>{e(S),Oa(()=>{e(i)})}),ve(H,5,()=>e(i),oe,(_,w)=>{var N=Ba(),le=f(N,!0);c(N);var ue={};B(()=>{Q(le,(e(w),D(()=>e(w).name))),ue!==(ue=(e(w),D(()=>e(w).id)))&&(N.value=(N.__value=(e(w),D(()=>e(w).id)))??"")}),$(_,N)}),c(H),c(G);var ie=x(G,2),U=f(ie);c(ie),c(C);var fe=x(C,2),se=x(f(fe),2);Ta(se),c(fe),c(g);var ne=x(g,2),ae=f(ne),we=f(ae);{var xe=_=>{var w=ye("Saved");$(_,w)},Ae=_=>{var w=ye("Save");$(_,w)};me(we,_=>{e(u)?_(xe):_(Ae,!1)})}c(ae);var te=x(ae,2);let be;var F=f(te);{var P=_=>{var w=Ya();$(_,w)},Y=_=>{var w=Ia(),N=Ne(w);{var le=X=>{var ce=ye();B(Z=>Q(ce,`Waiting for everyone (${Z??""}/15)`),[()=>(e(i),D(()=>e(i).filter(Z=>Z.name.trim()&&Z.keywords.trim()).length))]),$(X,ce)},ue=X=>{var ce=ye("Generate Order");$(X,ce)};me(N,X=>{e(p)?X(ue,!1):X(le)},!0)}$(_,w)};me(F,_=>{e(l)?_(P):_(Y,!1)})}c(te),c(ne);var I=x(ne,2),q=x(f(I),2);c(I),B(_=>{He(U,"src",`${qe??""}/rabbit1.png`),Ra(se,(e(a),D(()=>e(a).keywords))),be=$a(te,1,"generate-button svelte-1uha8ag",null,be,_),te.disabled=!e(p)||e(l)},[()=>({disabled:!e(p)||e(l)})]),Ga(H,()=>e(S),_=>E(S,_)),pe("input",se,L),pe("click",ae,()=>{O()}),pe("click",te,d),pe("click",q,z),$(r,v)};me(M,r=>{e(R),e(b),D(()=>e(R)&&e(b).length>0)?r(re):r(de,!1)})}c(h),$(t,h),Sa()}export{it as component};
