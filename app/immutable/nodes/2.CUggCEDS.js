import"../chunks/DsnmJJEf.js";import{i as Xe}from"../chunks/CPQpNnFn.js";import{o as Ze,e as fe,s as ee}from"../chunks/FhcG3dpi.js";import{c as Oe,h as ae,R as Qe,e as Fe,a as ea,b as aa,F as e,S as ta,r as ra,H as ia,s as Pe,d as Te,k as pe,T as sa,V as na,f as Re,i as la,W as ye,X as ke,g as oa,Y as ze,Z as Ke,_ as We,$ as j,a0 as $e,a1 as Le,j as Ve,p as va,a2 as Ce,a3 as da,a4 as je,a5 as ua,a6 as ca,a7 as fa,a8 as pa,a9 as _a,aa as ha,ab as ma,ac as ga,ad as wa,ae as ba,af as ya,ag as ka,K as Ea,ah as be,ai as xa,v as B,u as L,M as Aa,aj as k,O as _,B as D,P as c,q as Ie,Q as E,w as V,ak as Sa,al as Oa,am as Ta,an as _e,n as Ca,ao as Ia}from"../chunks/BGMrN2PN.js";import{i as he}from"../chunks/CMUbuGCI.js";import{s as Ge,a as Na}from"../chunks/DWTkkB4o.js";import{b as He}from"../chunks/C6oZqEL9.js";function ve(r,n){return n}function Ra(r,n,a){for(var i=r.items,t=[],v=n.length,l=0;l<v;l++)pa(n[l].e,t,!0);var d=v>0&&t.length===0&&a!==null;if(d){var b=a.parentNode;_a(b),b.append(a),i.clear(),J(r,n[0].prev,n[v-1].next)}ha(t,()=>{for(var A=0;A<v;A++){var y=n[A];d||(i.delete(y.k),J(r,y.prev,y.next)),je(y.e,!d)}})}function de(r,n,a,i,t,v=null){var l=r,d={flags:n,items:new Map,first:null},b=(n&ze)!==0;if(b){var A=r;l=ae?Oe(Qe(A)):A.appendChild(Fe())}ae&&ea();var y=null,O=!1,F=new Map,G=ta(()=>{var T=a();return We(T)?T:T==null?[]:Ke(T)}),f,x;function w(){Da(x,f,d,F,l,t,n,i,a),v!==null&&(f.length===0?y?Ve(y):y=Re(()=>v(l)):y!==null&&va(y,()=>{y=null}))}aa(()=>{x??=ma,f=e(G);var T=f.length;if(O&&T===0)return;O=T===0;let M=!1;if(ae){var z=ra(l)===ia;z!==(T===0)&&(l=Pe(),Oe(l),Te(!1),M=!0)}if(ae){for(var W=null,N,o=0;o<T;o++){if(pe.nodeType===sa&&pe.data===na){l=pe,M=!0,Te(!1);break}var m=f[o],P=i(m,o);N=De(pe,d,W,null,m,P,o,t,n,a),d.items.set(P,N),W=N}T>0&&Oe(Pe())}if(ae)T===0&&v&&(y=Re(()=>v(l)));else if(la()){var ie=new Set,s=oa;for(o=0;o<T;o+=1){m=f[o],P=i(m,o);var u=d.items.get(P)??F.get(P);u?(n&(ye|ke))!==0&&Be(u,m,o,n):(N=De(null,d,null,null,m,P,o,t,n,a,!0),F.set(P,N)),ie.add(P)}for(const[p,S]of d.items)ie.has(p)||s.skipped_effects.add(S.e);s.add_callback(w)}else w();M&&Te(!0),e(G)}),ae&&(l=pe)}function Da(r,n,a,i,t,v,l,d,b){var A=(l&ca)!==0,y=(l&(ye|ke))!==0,O=n.length,F=a.items,G=a.first,f=G,x,w=null,T,M=[],z=[],W,N,o,m;if(A)for(m=0;m<O;m+=1)W=n[m],N=d(W,m),o=F.get(N),o!==void 0&&(o.a?.measure(),(T??=new Set).add(o));for(m=0;m<O;m+=1){if(W=n[m],N=d(W,m),o=F.get(N),o===void 0){var P=i.get(N);if(P!==void 0){i.delete(N),F.set(N,P);var ie=w?w.next:f;J(a,w,P),J(a,P,ie),Ne(P,ie,t),w=P}else{var s=f?f.e.nodes_start:t;w=De(s,a,w,w===null?a.first:w.next,W,N,m,v,l,b)}F.set(N,w),M=[],z=[],f=w.next;continue}if(y&&Be(o,W,m,l),(o.e.f&Ce)!==0&&(Ve(o.e),A&&(o.a?.unfix(),(T??=new Set).delete(o))),o!==f){if(x!==void 0&&x.has(o)){if(M.length<z.length){var u=z[0],p;w=u.prev;var S=M[0],K=M[M.length-1];for(p=0;p<M.length;p+=1)Ne(M[p],u,t);for(p=0;p<z.length;p+=1)x.delete(z[p]);J(a,S.prev,K.next),J(a,w,S),J(a,K,u),f=u,w=K,m-=1,M=[],z=[]}else x.delete(o),Ne(o,f,t),J(a,o.prev,o.next),J(a,o,w===null?a.first:w.next),J(a,w,o),w=o;continue}for(M=[],z=[];f!==null&&f.k!==N;)(f.e.f&Ce)===0&&(x??=new Set).add(f),z.push(f),f=f.next;if(f===null)continue;o=f}M.push(o),w=o,f=o.next}if(f!==null||x!==void 0){for(var R=x===void 0?[]:Ke(x);f!==null;)(f.e.f&Ce)===0&&R.push(f),f=f.next;var U=R.length;if(U>0){var X=(l&ze)!==0&&O===0?t:null;if(A){for(m=0;m<U;m+=1)R[m].a?.measure();for(m=0;m<U;m+=1)R[m].a?.fix()}Ra(a,R,X)}}A&&da(()=>{if(T!==void 0)for(o of T)o.a?.apply()}),r.first=a.first&&a.first.e,r.last=w&&w.e;for(var se of i.values())je(se.e);i.clear()}function Be(r,n,a,i){(i&ye)!==0&&Le(r.v,n),(i&ke)!==0?Le(r.i,a):r.i=a}function De(r,n,a,i,t,v,l,d,b,A,y){var O=(b&ye)!==0,F=(b&ua)===0,G=O?F?j(t,!1,!1):$e(t):t,f=(b&ke)===0?l:$e(l),x={i:f,v:G,k:v,a:null,e:null,prev:a,next:i};try{if(r===null){var w=document.createDocumentFragment();w.append(r=Fe())}return x.e=Re(()=>d(r,G,f,A),ae),x.e.prev=a&&a.e,x.e.next=i&&i.e,a===null?y||(n.first=x):(a.next=x,a.e.next=x.e),i!==null&&(i.prev=x,i.e.prev=x.e),x}finally{}}function Ne(r,n,a){for(var i=r.next?r.next.e.nodes_start:a,t=n?n.e.nodes_start:a,v=r.e.nodes_start;v!==null&&v!==i;){var l=fa(v);t.before(v),v=l}}function J(r,n,a){n===null?r.first=a:(n.next=a,n.e.next=a&&a.e),a!==null&&(a.prev=n,a.e.prev=n&&n.e)}const qe=[...` 	
\r\fÂ \v\uFEFF`];function Ma(r,n,a){var i=""+r;if(a){for(var t in a)if(a[t])i=i?i+" "+t:t;else if(i.length)for(var v=t.length,l=0;(l=i.indexOf(t,l))>=0;){var d=l+v;(l===0||qe.includes(i[l-1]))&&(d===i.length||qe.includes(i[d]))?i=(l===0?"":i.substring(0,l))+i.substring(d+1):l=d}}return i===""?null:i}function Pa(r,n,a,i,t,v){var l=r.__className;if(ae||l!==a||l===void 0){var d=Ma(a,i,v);(!ae||d!==r.getAttribute("class"))&&(d==null?r.removeAttribute("class"):r.className=d),r.__className=a}else if(v&&t!==v)for(var b in v){var A=!!v[b];(t==null||A!==!!t[b])&&r.classList.toggle(b,A)}return v}function Ye(r,n,a=!1){if(r.multiple){if(n==null)return;if(!We(n))return ba();for(var i of r.options)i.selected=n.includes(me(i));return}for(i of r.options){var t=me(i);if(ya(t,n)){i.selected=!0;return}}(!a||n!==void 0)&&(r.selectedIndex=-1)}function $a(r){var n=new MutationObserver(()=>{Ye(r,r.__value)});n.observe(r,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ka(()=>{n.disconnect()})}function La(r,n,a=n){var i=!0;ga(r,"change",t=>{var v=t?"[selected]":":checked",l;if(r.multiple)l=[].map.call(r.querySelectorAll(v),me);else{var d=r.querySelector(v)??r.querySelector("option:not([disabled])");l=d&&me(d)}a(l)}),wa(()=>{var t=n();if(Ye(r,t,i),i&&t===void 0){var v=r.querySelector(":checked");v!==null&&(t=me(v),a(t))}r.__value=t,i=!1}),$a(r)}function me(r){return"__value"in r?r.__value:r.value}var Ga=B('<div class="participant-item svelte-1uha8ag"><div class="position svelte-1uha8ag"> </div> <div class="participant-name"> </div></div>'),Ha=B('<div class="theme-group"><h3 class="theme-title svelte-1uha8ag"> </h3> <div class="theme-participants"></div></div>'),qa=B('<div class="participant-item svelte-1uha8ag"><div class="position svelte-1uha8ag"></div> <div class="participant-info"><div class="participant-name"> </div></div></div>'),Fa=B('<div class="participant-item svelte-1uha8ag"><div class="position svelte-1uha8ag"></div> <div class="participant-info"><div class="participant-name"> </div></div></div>'),za=B('<div class="participant-item svelte-1uha8ag"><div class="position svelte-1uha8ag"></div> <div class="participant-info"><div class="participant-name"> </div></div></div>'),Ka=B('<div class="participant-item svelte-1uha8ag"><div class="position svelte-1uha8ag"></div> <div class="participant-info"><div class="participant-name"> </div></div></div>'),Wa=B("<p>No order generated yet.</p>"),Va=B(`<div class="rabbit svelte-1uha8ag"><img alt="Rabbit illustration" width="120"/></div> <div class="results svelte-1uha8ag"><div class="grouped-view svelte-1uha8ag"><h2 class="title-order svelte-1uha8ag">Grouped order</h2> <!></div> <div class="simple-view svelte-1uha8ag"><h2 class="title-order simple svelte-1uha8ag">Simple order</h2> <div class="participant-list-simple svelte-1uha8ag"><div class="participant-list-item"></div> <div class="participant-list-item"></div> <div class="participant-list-item"></div> <div class="participant-list-item"></div></div></div> <!></div> <div class="clear-section svelte-1uha8ag"><p class="clear-sign svelte-1uha8ag">don't press it unless the term is over</p> <button class="clear-button svelte-1uha8ag"><span>DANGER!! <br/> Clear all data</span></button></div>`,1),ja=B("<option> </option>"),Ba=B(`<div class="input-section svelte-1uha8ag"><div class="participant-list svelte-1uha8ag"><div class="select-container svelte-1uha8ag"><p class="svelte-1uha8ag">Who are you?</p> <select class="name-input svelte-1uha8ag"></select></div> <div class="rabbit1"><img alt="Rabbit illustration" width="120"/></div></div> <div class="keywords-container svelte-1uha8ag"><p class="svelte-1uha8ag">What are you up to?</p> <textarea class="keywords-input svelte-1uha8ag" placeholder="Keywords (comma separated)" rows="6"></textarea></div></div> <div class="action-section"><button class="save-button svelte-1uha8ag"><!></button> <button><!></button></div> <div class="clear-section svelte-1uha8ag"><p class="clear-sign svelte-1uha8ag">don't press it unless the term is over</p> <button class="clear-button svelte-1uha8ag"><span>DANGER!! <br/> Clear all data</span></button></div>`,1),Ya=B('<div class="main svelte-1uha8ag"><!></div>');function tt(r,n){Ea(n,!1);const a=j(),i=j();let t=j([{name:"Arnar",id:0,keywords:""},{name:"Cassandra",id:1,keywords:""},{name:"Costanza",id:2,keywords:""},{name:"Diana",id:3,keywords:""},{name:"Haotong",id:4,keywords:""},{name:"Kosara",id:5,keywords:""},{name:"Li",id:6,keywords:""},{name:"Luca M",id:7,keywords:""},{name:"Luca W",id:8,keywords:""},{name:"Lucas G",id:9,keywords:""},{name:"Martina",id:10,keywords:""},{name:"Matteo",id:11,keywords:""},{name:"Samuel",id:12,keywords:""},{name:"Sergio",id:13,keywords:""},{name:"Zhiyi",id:14,keywords:""}]),v=j(!1),l=j(!1),d=j([]),b=j([]),A=[],y=j(!1),O=j(0),F=!1,G=j(!1);const f="https://randominfo.vercel.app";Ze(async()=>{console.log("App mounting - initial state:",{participantCount:e(t).length,isRandomized:e(y),presentationOrderLength:e(d).length}),await x(),console.log("After loadData - final state:",{participantCount:e(t).length,isRandomized:e(y),presentationOrderLength:e(d).length})});async function x(){try{const s=await fetch(`${f}/api/data`);if(s.ok){const u=await s.json();k(t,u.participants||e(t)),k(O,u.selectedParticipantId??0),k(y,u.isRandomized||!1),k(d,u.presentationOrder||[]),k(b,u.simpleOrder||[]),A=u.groups||[],console.log("Data loaded successfully from server")}else console.warn("Server responded with error:",s.status,s.statusText),console.log("Keeping existing data intact")}catch(s){console.error("Error loading data:",s),console.log("Network/fetch error - keeping existing data intact")}}async function w(){if(!F){F=!0;try{const s=await fetch(`${f}/api/data`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({participants:e(t),selectedParticipantId:e(O),isRandomized:e(y),presentationOrder:e(d),simpleOrder:e(b),groups:A})});s.ok?(console.log("Data saved successfully to server"),k(G,!0)):(console.error("Failed to save data - server responded with:",s.status,s.statusText),k(G,!1))}catch(s){console.error("Error saving data:",s),console.error("Network/server error during save"),k(G,!1)}finally{F=!1}}}function T(s){k(G,!1);const u=e(t).map(p=>p.id===e(a).id?{...p,keywords:s.target.value}:p);k(t,u)}async function M(){try{(await fetch(`${f}/api/data`,{method:"DELETE"})).ok?(k(t,e(t).map(u=>({...u,keywords:""}))),k(y,!1),k(d,[]),k(b,[]),A=[],k(O,0)):console.error("Failed to clear data")}catch(s){console.error("Error clearing data:",s)}}function z(s){const u=[...s];for(let p=u.length-1;p>0;p--){const S=Math.floor(Math.random()*(p+1));[u[p],u[S]]=[u[S],u[p]]}return u}function W(){return e(t).filter(s=>s.keywords.trim()!=="").map(s=>({name:s.name,keywords:s.keywords.trim()}))}async function N(){if(!(!e(l)||e(y))){k(v,!0);try{console.log(`Calling API at ${f}`);const s=W(),u=await fetch(`${f}/api/group-topics`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({participants:s})});if(!u.ok){const R=await u.json().catch(()=>({}));throw new Error(R.message||`HTTP ${u.status}: ${u.statusText}`)}const p=await u.json();if(!p.groups||!Array.isArray(p.groups))throw new Error("Invalid response format from server");console.log("Received data:",p);const S=z([...p.groups]),K=[];S.forEach(R=>{z([...R.members]).forEach(X=>{K.push({...X,theme:R.theme})})}),k(d,K),A=S,k(b,z([...W()])),k(y,!0),await w()}catch(s){console.error("Error generating order:",s),`${s.message}`,s.message.includes("fetch")||s.message.includes("quota")||s.message.includes("API key")}finally{k(v,!1)}}}be(()=>e(O),()=>{e(O)!==void 0&&k(G,!1)}),be(()=>(e(t),e(G)),()=>{k(l,e(t).every(s=>s.keywords.trim()!==""&&e(G)==!0))}),be(()=>(e(t),e(O)),()=>{k(a,e(t).find(s=>s.id===e(O))||e(t)[0])}),be(()=>e(d),()=>{k(i,e(d).reduce((s,u,p)=>{const S=u.theme;return s[S]||(s[S]=[]),s[S].push({...u,position:p+1}),s},{}))}),xa(),Xe();var o=Ya(),m=_(o);{var P=s=>{var u=Va(),p=Ie(u),S=_(p);c(p);var K=E(p,2),R=_(K),U=E(_(R),2);de(U,1,()=>(e(i),D(()=>Object.entries(e(i)))),ve,(q,$,Y,C)=>{var H=Ta(()=>Ia(e($),2));let h=()=>e(H)[0],g=()=>e(H)[1];var I=Ha(),oe=_(I),ue=_(oe,!0);c(oe);var Z=E(oe,2);de(Z,5,g,ve,(ce,Q)=>{var Ae=Ga(),Se=_(Ae),Je=_(Se);c(Se);var Me=E(Se,2),Ue=_(Me,!0);c(Me),c(Ae),V(()=>{ee(Je,`${e(Q),D(()=>e(Q).position)??""}.`),ee(Ue,(e(Q),D(()=>e(Q).name)))}),L(ce,Ae)}),c(Z),c(I),V(()=>ee(ue,h())),L(q,I)}),c(R);var X=E(R,2),se=E(_(X),2),ne=_(se);de(ne,5,()=>(e(b),D(()=>e(b).slice(0,4))),ve,(q,$,Y)=>{var C=qa(),H=_(C);H.textContent=`${Y+1}.`;var h=E(H,2),g=_(h),I=_(g,!0);c(g),c(h),c(C),V(()=>ee(I,(e($),D(()=>[e($).name])))),L(q,C)}),c(ne);var le=E(ne,2);de(le,5,()=>(e(b),D(()=>e(b).slice(4,8))),ve,(q,$,Y)=>{var C=Fa(),H=_(C);H.textContent=`${Y+5}.`;var h=E(H,2),g=_(h),I=_(g,!0);c(g),c(h),c(C),V(()=>ee(I,(e($),D(()=>[e($).name])))),L(q,C)}),c(le);var te=E(le,2);de(te,5,()=>(e(b),D(()=>e(b).slice(8,12))),ve,(q,$,Y)=>{var C=za(),H=_(C);H.textContent=`${Y+9}.`;var h=E(H,2),g=_(h),I=_(g,!0);c(g),c(h),c(C),V(()=>ee(I,(e($),D(()=>[e($).name])))),L(q,C)}),c(te);var ge=E(te,2);de(ge,5,()=>(e(b),D(()=>e(b).slice(12,16))),ve,(q,$,Y)=>{var C=Ka(),H=_(C);H.textContent=`${Y+13}.`;var h=E(H,2),g=_(h),I=_(g,!0);c(g),c(h),c(C),V(()=>ee(I,(e($),D(()=>[e($).name])))),L(q,C)}),c(ge),c(se),c(X);var Ee=E(X,2);{var xe=q=>{var $=Wa();L(q,$)};he(Ee,q=>{e(d),D(()=>e(d).length===0)&&q(xe)})}c(K);var re=E(K,2),we=E(_(re),2);c(re),V(()=>Ge(S,"src",`${He??""}/rabbit2.png`)),fe("click",we,M),L(s,u)},ie=s=>{var u=Ba(),p=Ie(u),S=_(p),K=_(S),R=E(_(K),2);V(()=>{e(O),Sa(()=>{e(t)})}),de(R,5,()=>e(t),ve,(h,g)=>{var I=ja(),oe=_(I,!0);c(I);var ue={};V(()=>{ee(oe,(e(g),D(()=>e(g).name))),ue!==(ue=(e(g),D(()=>e(g).id)))&&(I.value=(I.__value=(e(g),D(()=>e(g).id)))??"")}),L(h,I)}),c(R),c(K);var U=E(K,2),X=_(U);c(U),c(S);var se=E(S,2),ne=E(_(se),2);Oa(ne),c(se),c(p);var le=E(p,2),te=_(le),ge=_(te);{var Ee=h=>{var g=_e("Saved");L(h,g)},xe=h=>{var g=_e("Save");L(h,g)};he(ge,h=>{e(G)?h(Ee):h(xe,!1)})}c(te);var re=E(te,2);let we;var q=_(re);{var $=h=>{var g=_e("Generating...");L(h,g)},Y=h=>{var g=Ca(),I=Ie(g);{var oe=Z=>{var ce=_e();V(Q=>ee(ce,`Waiting for everyone (${Q??""}/15)`),[()=>(e(t),D(()=>e(t).filter(Q=>Q.name.trim()&&Q.keywords.trim()).length))]),L(Z,ce)},ue=Z=>{var ce=_e("Generate Order");L(Z,ce)};he(I,Z=>{e(l)?Z(ue,!1):Z(oe)},!0)}L(h,g)};he(q,h=>{e(v)?h($):h(Y,!1)})}c(re),c(le);var C=E(le,2),H=E(_(C),2);c(C),V(h=>{Ge(X,"src",`${He??""}/rabbit1.png`),Na(ne,(e(a),D(()=>e(a).keywords))),we=Pa(re,1,"generate-button svelte-1uha8ag",null,we,h),re.disabled=!e(l)||e(v)},[()=>({disabled:!e(l)||e(v)})]),La(R,()=>e(O),h=>k(O,h)),fe("input",ne,T),fe("click",te,()=>{w()}),fe("click",re,N),fe("click",H,M),L(s,u)};he(m,s=>{e(y),e(d),D(()=>e(y)&&e(d).length>0)?s(P):s(ie,!1)})}c(o),L(r,o),Aa()}export{tt as component};
